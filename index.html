<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Advanced Dietician App with Live Connected Dots Background</title>
<style>
  html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100vh;
    font-family: Arial, sans-serif;
    background: #121212;
    color: white;
    overflow: hidden;
  }
  canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    z-index: -1;
    display: block;
  }
  #appPanel {
    position: relative;
    max-width: 800px;
    margin: 40px auto;
    background: rgba(20, 20, 20, 0.9);
    border-radius: 16px;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.25);
    padding: 30px 40px;
    z-index: 10;
  }
  #appPanel h1 {
    color: #00fff7;
    margin-top: 0;
    text-align: center;
    font-weight: bold;
  }
  label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
  }
  input, textarea, button {
    width: 100%;
    padding: 10px 14px;
    margin-bottom: 16px;
    border-radius: 8px;
    background-color: #222;
    border: 1px solid #333;
    color: white;
    font-size: 1em;
    outline: none;
  }
  input:focus, textarea:focus {
    border-color: #00fff7;
    box-shadow: 0 0 8px #00fff7;
  }
  button {
    cursor: pointer;
    border: none;
    background-color: #00fff7;
    color: #111;
    font-weight: bold;
    transition: background-color 0.3s;
  }
  button:hover {
    background-color: #00ccc7;
  }
  textarea {
    resize: vertical;
    min-height: 140px;
    max-height: 300px;
    overflow-y: auto;
  }
  .row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  .col {
    flex: 1;
    min-width: 160px;
  }
</style>
</head>
<body>

<canvas id="backgroundCanvas"></canvas>

<div id="appPanel">
  <h1>Advanced Dietician App</h1>

  <div>
    <h2>Profile Information</h2>
    <div class="row">
      <div class="col">
        <label for="age">Age (years)</label>
        <input type="number" id="age" placeholder="30" />
      </div>
      <div class="col">
        <label for="weight">Weight (kg)</label>
        <input type="number" id="weight" placeholder="70" />
      </div>
      <div class="col">
        <label for="height">Height (cm)</label>
        <input type="number" id="height" placeholder="175" />
      </div>
      <div class="col" style="flex-grow: 2;">
        <label for="diet">Diet Preference</label>
        <input type="text" id="diet" placeholder="e.g. Vegan, Keto" />
      </div>
    </div>
    <button id="calcBtn">Calculate BMI & Advice</button>
    <textarea id="bmiAdvice" readonly placeholder="Your health advice based on profile will appear here."></textarea>
  </div>

  <div>
    <h2>Nutrition Lookup</h2>
    <input type="text" id="foodQuery" placeholder="Enter food name to search" />
    <button id="searchBtn">Search Nutrition</button>
    <textarea id="nutritionResult" readonly placeholder="Nutrition data will appear here."></textarea>
  </div>
</div>

<script>
  // Setup Canvas
  const canvas = document.getElementById('backgroundCanvas');
  const ctx = canvas.getContext('2d');
  let width, height;

  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }
  resize();
  window.addEventListener('resize', () => {
    resize();
    initializeDots();
  });

  class Dot {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.radius = 3;
      this.vx = (Math.random() - 0.5) * 0.5;
      this.vy = (Math.random() - 0.5) * 0.5;
    }
    update() {
      this.x += this.vx;
      this.y += this.vy;
      if (this.x < this.radius || this.x > width - this.radius) this.vx *= -1;
      if (this.y < this.radius || this.y > height - this.radius) this.vy *= -1;
    }
    draw() {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(0,255,255,0.8)';
      ctx.fill();
    }
  }

  let dots = [];
  const gap = 120;
  const maxDistance = 130;

  function initializeDots() {
    dots = [];
    for (let x = gap / 2; x < width; x += gap) {
      for (let y = gap / 2; y < height; y += gap) {
        dots.push(new Dot(x + (Math.random() * 40 - 20), y + (Math.random() * 40 - 20)));
      }
    }
  }
  initializeDots();

  function distance(a, b) {
    return Math.hypot(a.x - b.x, a.y - b.y);
  }

  function animate() {
    ctx.clearRect(0, 0, width, height);

    dots.forEach((dot, i) => {
      dot.draw();
      dot.update();
      for (let j = i + 1; j < dots.length; j++) {
        let dist = distance(dot, dots[j]);
        if (dist < maxDistance) {
          ctx.strokeStyle = `rgba(0,255,255,${1 - dist / maxDistance})`;
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(dot.x, dot.y);
          ctx.lineTo(dots[j].x, dots[j].y);
          ctx.stroke();
        }
      }
    });
    requestAnimationFrame(animate);
  }
  animate();

  // BMI Calculator Logic
  function calculateBMI(weight, height) {
    let h = height / 100;
    return +(weight / (h * h)).toFixed(1);
  }

  function getBMICategory(bmi) {
    if (bmi < 18.5) return 'Underweight';
    if (bmi < 25) return 'Normal weight';
    if (bmi < 30) return 'Overweight';
    return 'Obese';
  }

  document.getElementById('calcBtn').addEventListener('click', () => {
    const age = document.getElementById('age').value.trim();
    const weight = parseFloat(document.getElementById('weight').value);
    const height = parseFloat(document.getElementById('height').value);
    const diet = document.getElementById('diet').value.trim();

    if (!weight || !height || weight <= 0 || height <= 0) {
      alert('Please enter valid positive values for weight and height.');
      return;
    }

    const bmi = calculateBMI(weight, height);
    const category = getBMICategory(bmi);
    let advice = `Your BMI is ${bmi} (${category}).\n`;
    switch(category) {
      case 'Underweight':
        advice += 'Consider calorie-rich, nutrient-dense foods.\n';
        break;
      case 'Normal weight':
        advice += 'Maintain a balanced diet and regular exercise.\n';
        break;
      case 'Overweight':
        advice += 'Reduce calorie intake and increase physical activity.\n';
        break;
      case 'Obese':
        advice += 'Seek professional medical advice for weight management.\n';
        break;
    }
    if (diet) {
      advice += `Diet preference: "${diet}". Make sure to include necessary nutrients.\n`;
    }
    if (age) {
      advice += `Age: ${age}. Nutrient needs vary with age.\n`;
    }
    document.getElementById('bmiAdvice').value = advice;
  });

  // Nutrition Lookup Logic
  document.getElementById('searchBtn').addEventListener('click', async () => {
    const food = document.getElementById('foodQuery').value.trim();
    const output = document.getElementById('nutritionResult');
    if (!food) {
      alert('Enter a food name to search.');
      return;
    }
    output.value = 'Loading nutrition info...';

    try {
      const apiKey = 'evbkpkYjm9qBAe6gXrcAgIhhFechn8Tj3Yd4AuIp'; // Replace with your USDA API key
      const response = await fetch(`https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${apiKey}&query=${encodeURIComponent(food)}&pageSize=1`);
      const data = await response.json();
      if (!data.foods || data.foods.length === 0) {
        output.value = 'No nutrition data found.';
        return;
      }
      const item = data.foods[0];
      let nutrients = {};
      item.foodNutrients.forEach(n => {
        const name = n.nutrientName.toLowerCase();
        if (name.includes("energy")) nutrients.Calories = n.value;
        if (name.includes("protein")) nutrients.Protein = n.value;
        if (name.includes("fat")) nutrients.Fat = n.value;
        if (name.includes("carbohydrate")) nutrients.Carbohydrates = n.value;
      });
      let result = `${item.description} (per serving):\n`;
      for (const [key, val] of Object.entries(nutrients)) {
        result += `${key}: ${val}\n`;
      }
      output.value = result;
    } catch (e) {
      output.value = 'Error fetching nutrition data.';
    }
  });
</script>

</body>
</html>
