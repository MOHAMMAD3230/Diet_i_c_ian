<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8" /><title>Dietician</title></head>
<body>
  <!-- Inputs for age, weight, height, diet -->
  <input id="age" placeholder="Age" type="number" />
  <input id="weight" placeholder="Weight (kg)" type="number" />
  <input id="height" placeholder="Height (cm)" type="number" />
  <input id="diet" placeholder="Diet preference" type="text" />
  <button id="advise-btn">Get Advice</button>

  <!-- Food input -->
  <input id="food" placeholder="Enter food name" />
  <button id="fetch-nutrition-btn">Get Nutrition</button>

  <!-- Chat div -->
  <div id="chat"></div>

  <script>
    const chat = document.getElementById('chat');

    function appendMessage(msg, fromBot=true) {
      const div = document.createElement('div');
      div.textContent = msg;
      div.style.color = fromBot ? 'green' : 'black';
      chat.appendChild(div);
    }

    function calculateBMI(weight, height) {
      const h = height / 100;
      return (weight / (h * h)).toFixed(1);
    }

    function advice(bmi, diet) {
      let cat = '';
      if (bmi < 18.5) cat = 'underweight';
      else if (bmi < 25) cat = 'normal weight';
      else if (bmi < 30) cat = 'overweight';
      else cat = 'obese';

      let msg = `Your BMI is ${bmi} (${cat}). `;
      if(cat==='underweight') msg += 'Consider nutrient-rich foods.';
      else if(cat==='normal weight') msg += 'Maintain balanced diet.';
      else if(cat==='overweight') msg += 'Monitor calorie intake.';
      else msg += 'Consult healthcare provider.';

      if(diet) msg += ` Your diet is ${diet}. Choose foods accordingly.`;
      return msg;
    }

    document.getElementById('advise-btn').onclick = () => {
      const age = parseInt(document.getElementById('age').value);
      const weight = parseFloat(document.getElementById('weight').value);
      const height = parseFloat(document.getElementById('height').value);
      const diet = document.getElementById('diet').value;

      if(!weight || !height){
        appendMessage('Please enter valid weight and height');
        return;
      }

      const bmi = calculateBMI(weight, height);
      appendMessage(advice(bmi, diet));
    };

    document.getElementById('fetch-nutrition-btn').onclick = async () => {
      const foodName = document.getElementById('food').value;
      if(!foodName) {
        appendMessage('Please enter a food name');
        return;
      }
      appendMessage(`Fetching nutrition for ${foodName}...`);

      try {
        const res = await fetch('/nutrition', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ foodName })
        });
        const data = await res.json();
        if(data.foods && data.foods.length > 0){
          const item = data.foods[0];
          appendMessage(`Found: ${item.description}`);
          let nutrientsMsg = '';
          item.foodNutrients.forEach(n => {
            nutrientsMsg += `${n.nutrientName}: ${n.value} ${n.unitName}\n`;
          });
          appendMessage(nutrientsMsg);
        } else appendMessage('No nutrition data found.');
      } catch(e) {
        appendMessage('Error fetching nutrition data.');
      }
    };
  </script>
</body>
</html>
